# Структура обработчиков Telegram бота

Этот модуль содержит все обработчики команд и callback-запросов для Telegram бота, организованные по функциональным группам согласно принципам DRY, ООП и Clean Code.

## Структура файлов

### Базовые компоненты

- **`base.py`** - Базовые классы и утилиты:
  - `BaseHandler` - абстрактный базовый класс для всех обработчиков
  - `StateManager` - менеджер состояний FSM
  - `ErrorHandler` - обработчик ошибок
  - `ResponseFormatter` - форматировщик ответов

- **`states.py`** - Состояния FSM для различных процессов:
  - `TransactionStates` - состояния для создания транзакций
  - `WalletStates` - состояния для создания кошельков
  - `CategoryStates` - состояния для создания категорий
  - `SettingsStates` - состояния для настроек

### Функциональные обработчики

- **`transaction_handlers.py`** - Обработчики транзакций (доходы и расходы):
  - Создание доходов и расходов
  - FSM состояния для ввода данных транзакции
  - Выбор кошелька и категории
  - Валидация и сохранение транзакций

- **`wallet_handlers.py`** - Обработчики кошельков:
  - Создание новых кошельков
  - Выбор валюты
  - Управление кошельками

- **`category_handlers.py`** - Обработчики категорий транзакций:
  - Создание категорий
  - Иерархическая структура категорий
  - Выбор родительской категории

- **`balance_handlers.py`** - Обработчики баланса и статистики:
  - Отображение баланса кошельков
  - Общий баланс пользователя

- **`settings_handlers.py`** - Обработчики настроек и помощи:
  - Команда /start
  - Справка по командам
  - Настройки пользователя

### Главный роутер

- **`main_router.py`** - Главный роутер для объединения всех обработчиков:
  - Создание экземпляров всех обработчиков
  - Регистрация роутеров в диспетчере

## Принципы архитектуры

### DRY (Don't Repeat Yourself)
- Общие утилиты вынесены в базовые классы
- Повторяющаяся логика обработки ошибок централизована
- Единообразное форматирование ответов

### ООП (Объектно-ориентированное программирование)
- Каждый тип обработчиков наследуется от `BaseHandler`
- Инкапсуляция логики в соответствующих классах
- Полиморфизм через единый интерфейс `get_router()`

### Clean Code
- Четкое разделение ответственности между классами
- Понятные имена методов и переменных
- Логическая группировка функциональности
- Минимальные зависимости между модулями

## Использование

```python
from telegram_bot.handlers import register_handlers

# Регистрация всех обработчиков в диспетчере
register_handlers(dp)
```

## Расширение функциональности

Для добавления новых обработчиков:

1. Создайте новый класс, наследующийся от `BaseHandler`
2. Реализуйте метод `_register_handlers()`
3. Добавьте импорт и регистрацию в `main_router.py`

Пример:
```python
class NewFeatureHandler(BaseHandler):
    def _register_handlers(self):
        self.router.message.register(self.handle_command, Command("new_command"))
    
    async def handle_command(self, message: Message):
        await message.answer("Новая функциональность!")
```
