{% extends 'telegram_bot/base.html' %}

{% block title %}–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Mini App - –î–æ–º–∞—à–Ω—è—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è{% endblock %}
{% block header %}–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Mini App{% endblock %}

{% block content %}
<div class="tg-fade-in">
    <div class="tg-card">
        <h5 class="tg-mb-2">üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
        <p class="tg-text-muted">–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Mini App</p>
    </div>

    <div class="tg-card">
        <h6 class="tg-mb-2">üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h6>
        <div class="table-responsive">
            <table class="tg-table">
                <tbody>
                    <tr>
                        <td><strong>DEBUG —Ä–µ–∂–∏–º</strong></td>
                        <td>
                            <span class="badge {% if config_info.DEBUG %}bg-success{% else %}bg-secondary{% endif %}">
                                {{ config_info.DEBUG|yesno:"–í–∫–ª—é—á–µ–Ω,–í—ã–∫–ª—é—á–µ–Ω" }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>URL Mini App</strong></td>
                        <td>{{ config_info.TELEGRAM_MINIAPP_URL|default:"–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω" }}</td>
                    </tr>
                    <tr>
                        <td><strong>–†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏</strong></td>
                        <td>
                            <span class="badge {% if config_info.TELEGRAM_MINIAPP_DEBUG_MODE %}bg-warning{% else %}bg-secondary{% endif %}">
                                {{ config_info.TELEGRAM_MINIAPP_DEBUG_MODE|yesno:"–í–∫–ª—é—á–µ–Ω,–í—ã–∫–ª—é—á–µ–Ω" }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>–†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ö–æ—Å—Ç—ã</strong></td>
                        <td>{{ config_info.ALLOWED_HOSTS|join:", " }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="tg-card">
        <h6 class="tg-mb-2">üåê –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–ø—Ä–æ—Å–µ</h6>
        <div class="table-responsive">
            <table class="tg-table">
                <tbody>
                    <tr>
                        <td><strong>–•–æ—Å—Ç –∑–∞–ø—Ä–æ—Å–∞</strong></td>
                        <td>{{ config_info.request_host }}</td>
                    </tr>
                    <tr>
                        <td><strong>–ú–µ—Ç–æ–¥</strong></td>
                        <td>{{ config_info.request_method }}</td>
                    </tr>
                    <tr>
                        <td><strong>User Agent</strong></td>
                        <td class="small">{{ config_info.user_agent|truncatechars:50 }}</td>
                    </tr>
                    <tr>
                        <td><strong>Telegram –∑–∞–ø—Ä–æ—Å</strong></td>
                        <td>
                            <span class="badge {% if config_info.is_telegram_request %}bg-success{% else %}bg-danger{% endif %}">
                                {{ config_info.is_telegram_request|yesno:"–î–∞,–ù–µ—Ç" }}
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Telegram –¥–∞–Ω–Ω—ã–µ</strong></td>
                        <td class="small">{{ config_info.telegram_data }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    {% if not config_info.is_telegram_request %}
    <div class="tg-card">
        <h6 class="tg-text-warning tg-mb-2">‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</h6>
        <p class="tg-text-muted">
            –í—ã –æ—Ç–∫—Ä—ã–ª–∏ Mini App –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞, –∞ –Ω–µ –∏–∑ Telegram. 
            –î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã Mini App –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞.
        </p>
        
        {% if config_info.TELEGRAM_MINIAPP_DEBUG_MODE %}
        <div class="tg-alert tg-alert-info">
            <strong>–†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –≤–∫–ª—é—á–µ–Ω:</strong> Mini App —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–µ—Å—Ç–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.
        </div>
        {% else %}
        <div class="tg-alert tg-alert-danger">
            <strong>–†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –≤—ã–∫–ª—é—á–µ–Ω:</strong> Mini App —Ç—Ä–µ–±—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç Telegram.
            –í–∫–ª—é—á–∏—Ç–µ <code>TELEGRAM_MINIAPP_DEBUG_MODE=True</code> –≤ .env –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
        </div>
        {% endif %}
    </div>
    {% endif %}

    <div class="tg-card">
        <h6 class="tg-mb-2">üöÄ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h6>
        <div class="row g-2">
            <div class="col-6">
                <a href="{% url 'telegram_bot:mini_app_dashboard' %}" class="btn tg-button w-100">
                    <i class="bi bi-house-door"></i> –ì–ª–∞–≤–Ω–∞—è
                </a>
            </div>
            <div class="col-6">
                <a href="{% url 'telegram_bot:transactions' %}" class="btn tg-button-secondary w-100">
                    <i class="bi bi-list-ul"></i> –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                </a>
            </div>
        </div>
    </div>

    <div class="tg-card">
        <h6 class="tg-mb-2">üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ</h6>
        <div class="small tg-text-muted">
            <ol>
                <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —Ñ–∞–π–ª–µ <code>.env</code> —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π <code>TELEGRAM_MINIAPP_URL</code></li>
                <li>–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ –≤–∫–ª—é—á–∏—Ç–µ <code>TELEGRAM_MINIAPP_DEBUG_MODE=True</code></li>
                <li>–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ <code>TELEGRAM_MINIAPP_DEBUG_MODE=False</code></li>
                <li>–î–æ–º–µ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–ø–∏—Å–∫–µ <code>ALLOWED_HOSTS</code></li>
                <li>Mini App –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥–æ–π <code>/app</code></li>
            </ol>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
setTimeout(function() {
    location.reload();
}, 30000);
</script>
{% endblock %}
